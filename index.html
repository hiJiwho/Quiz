<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON í€´ì¦ˆ ìƒì„±ê¸° (í’€ê¸° ë° ì¸ì‡„)</title>
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ê¸°ë³¸ ê¸€ê¼´ ì„¤ì • */
        body {
            font-family: 'Inter', 'Pretendard', sans-serif;
        }

        /* * ======================================
         * ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼ (A4 ìš©ì§€)
         * (ìˆ˜ì •) 10pt í°íŠ¸, 2ì—´(column) ë ˆì´ì•„ì›ƒ ì ìš©
         * ======================================
         */
        @media print {
            /* * 1. ì•±ì˜ UI(ë²„íŠ¼, ì…ë ¥ì°½ ë“±)ëŠ” ëª¨ë‘ ìˆ¨ê¹ë‹ˆë‹¤.
             */
            body > #app-container {
                display: none;
            }

            /* * 2. ì¸ì‡„ ì „ìš© ì˜ì—­(#printable-area)ë§Œ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
             */
            body > #printable-area {
                display: block !important; /* ê°•ì œë¡œ ë³´ì´ê²Œ í•¨ */
            }

            /* * 3. A4 ìš©ì§€ ì—¬ë°± ì„¤ì •
             */
            @page {
                size: A4;
                margin: 1.2cm;
            }

            /* * 4. ì¸ì‡„ìš© í°íŠ¸ ë° í˜ì´ì§€ ë‚˜ëˆ” ì„¤ì •
             */
            #printable-area {
                font-size: 10pt; /* (ìˆ˜ì •) 10pt í°íŠ¸ë¡œ ì„¤ì • */
                color: #000;
            }
            
            /* (ì‹ ê·œ) 2ì—´ ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ */
            .print-column-container {
                column-count: 2;
                column-gap: 1.5cm; /* 1.5cm ê°„ê²© */
            }

            .print-question-item {
                margin-bottom: 10px;
                page-break-inside: avoid; /* ì—´(column)ì´ë‚˜ í˜ì´ì§€ ì¤‘ê°„ì— ì˜ë¦¬ëŠ” ê²ƒì„ ë°©ì§€ */
            }

            .print-question-title {
                font-size: 1.1em;
                font-weight: bold;
                margin-bottom: 5px;
            }
            
            .print-question-svg {
                margin: 6px 0;
                max-width: 240px;
                margin-left: auto;
                margin-right: auto;
            }
            .print-question-svg svg {
                max-width: 100%;
                height: auto;
                border: 1px solid #ccc;
            }

            .print-options {
                list-style-type: none; /* JSì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‚½ì… */
                list-style-position: inside;
                padding-left: 5px;
            }

            .print-option-item {
                display: flex;
                align-items: center;
                margin-bottom: 3px;
            }
            .print-option-svg {
                width: 26px;
                height: 26px;
                margin-left: 8px;
                border: 1px solid #ddd;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            .print-option-svg svg {
                width: 100%;
                height: 100%;
            }

            .print-answer {
                font-weight: bold;
                color: #333;
                margin-top: 5px;
            }
            
            .print-explanation {
                font-size: 0.95em;
                color: #444;
                margin-top: 4px;
                border-left: 2px solid #ddd;
                padding-left: 8px;
            }
            
            .print-quiz-title { /* (ì‹ ê·œ) í€´ì¦ˆ ì œëª© */
                text-align: center;
                font-size: 1.6em;
                font-weight: bold;
                margin-bottom: 0.8cm;
                margin-top: 0.2cm;
            }

            .print-answer-key-title {
                text-align: center;
                font-size: 1.4em;
                font-weight: bold;
                margin-top: 0.5cm;
                margin-bottom: 12px;
            }
            
            .print-quick-key-title {
                font-size: 1.2em;
                font-weight: bold;
                margin-top: 12px;
                margin-bottom: 8px;
                border-bottom: 1px solid #666;
                padding-bottom: 4px;
            }
            .print-quick-key-container {
                margin-bottom: 15px;
                page-break-inside: avoid;
                font-size: 10pt;
            }
            .print-quick-key-item {
                display: inline-block;
                margin: 0 10px 4px 0;
                font-weight: bold;
                min-width: 55px;
            }

            .print-detailed-explanation-title {
                font-size: 1.2em;
                font-weight: bold;
                margin-top: 20px;
                margin-bottom: 8px;
                border-bottom: 1px solid #666;
                padding-bottom: 4px;
            }

            .print-answer-item {
                margin-bottom: 8px;
                page-break-inside: avoid; /* ì—´(column)ì´ë‚˜ í˜ì´ì§€ ì¤‘ê°„ì— ì˜ë¦¬ëŠ” ê²ƒì„ ë°©ì§€ */
            }
        }

        /* * ======================================
         * ì•± UI ìŠ¤íƒ€ì¼ (Tailwind ëŒ€ì²´)
         * ======================================
         */
        
        /* SVG ë³´ê¸° ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .svg-option:hover > rect {
            fill: #e5e7eb; /* bg-gray-200 */
        }

        /* (ì‹ ê·œ) í€´ì¦ˆ ë ˆì´ì•„ì›ƒ - ë¬¸ì œ/SVG ì˜ì—­ + ë³´ê¸° ì˜ì—­ */
        #quiz-content-area {
            display: flex;
            gap: 24px; /* gap-6 */
            min-height: 400px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
        }
        #quiz-question-area { /* ì™¼ìª½: ë¬¸ì œ, SVG */
            flex: 1 1 50%; /* (ìˆ˜ì •) ê¸°ë³¸ 50% ë„ˆë¹„ */
            padding-right: 16px; /* pr-4 */
            border-right: 1px solid #e5e7eb; /* border-r border-gray-200 */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        #quiz-options-area { /* ì˜¤ë¥¸ìª½: ë³´ê¸° */
            flex: 1 1 50%; /* (ìˆ˜ì •) ê¸°ë³¸ 50% ë„ˆë¹„ */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* (ì‹ ê·œ) íƒ€ì´ë¨¸ ë°” ìŠ¤íƒ€ì¼ */
        #timer-bar-container {
            width: 100%;
            background-color: #e0e7ff; /* bg-indigo-100 */
            border-radius: 4px; /* rounded */
            height: 8px; /* h-2 */
            margin-top: 16px; /* mt-4 */
            overflow: hidden;
        }
        #timer-bar {
            height: 100%;
            background-color: #6366f1; /* bg-indigo-500 */
            width: 100%;
            transition: width 1s linear; /* ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ (1ì´ˆë§ˆë‹¤) */
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-10">

    <!-- 
      ======================================
      ì•± ë©”ì¸ ì»¨í…Œì´ë„ˆ
      (ìˆ˜ì •) max-w-4xl -> max-w-5xl
      ======================================
    --><div id="app-container" class="max-w-5xl mx-auto bg-white shadow-2xl rounded-xl overflow-hidden">
        
        <!-- 1. JSON ì…ë ¥ ì„¹ì…˜ --><div id="json-input-section" class="p-6 md:p-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">JSON í€´ì¦ˆ ìƒì„±ê¸°</h1>
            <p class="text-gray-600 mb-5">
                ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— í€´ì¦ˆ ë¬¸ì œë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
                <br>
                ì˜ˆì œ JSONì„ ì°¸ê³ í•˜ì—¬ í˜•ì‹ì„ ë§ì¶”ê±°ë‚˜, ì§ì ‘ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>

            <!-- JSON ì…ë ¥ì°½ --><textarea id="json-input" rows="15" class="w-full p-4 border border-gray-300 rounded-lg font-mono text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
            
            <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ --><p id="json-error" class="text-red-600 font-semibold mt-2 hidden"></p>

            <div class="flex flex-col gap-3 mt-4">
                <button id="load-json-btn" class="w-full bg-blue-600 text-white px-5 py-3 rounded-lg font-bold hover:bg-blue-700 transition duration-200">
                    ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <div class="grid grid-cols-3 gap-3">
                    <button id="reset-default-json-btn" class="w-full bg-gray-200 text-gray-700 px-5 py-3 rounded-lg hover:bg-gray-300 transition duration-200">
                        ì˜ˆì œ ì´ˆê¸°í™”
                    </button>
                    <button id="copy-json-btn" class="w-full bg-gray-200 text-gray-700 px-5 py-3 rounded-lg hover:bg-gray-300 transition duration-200">
                        ì˜ˆì œ ë³µì‚¬
                    </button>
                    <button id="clear-json-btn" class="w-full bg-red-500 text-white px-5 py-3 rounded-lg hover:bg-red-600 transition duration-200">
                        ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 2. ì•¡ì…˜ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ (JSON ë¡œë“œ í›„ ë³´ì„) --><div id="action-controls" class="p-6 md:p-8 border-t border-gray-200 hidden">
            <h2 id="quiz-title-display" class="text-2xl font-bold text-gray-800 mb-4 text-center"></h2> <!-- (ì‹ ê·œ) í€´ì¦ˆ ì œëª© í‘œì‹œ --><div id="load-status" class="hidden mb-4 p-4 bg-green-100 text-green-800 rounded-lg">
                <span id="question-count" class="font-bold">0</span>ê°œì˜ ë¬¸ì œë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.
                <span id="timer-setting-display" class="block text-sm text-green-700 mt-1 hidden"></span> <!-- (ìˆ˜ì •) íƒ€ì´ë¨¸ ì„¤ì • í‘œì‹œ --></div>
            <div class="grid grid-cols-1 gap-4">
                <button id="start-quiz-btn" class="w-full bg-green-600 text-white p-4 rounded-lg font-bold text-lg hover:bg-green-700 transition">
                    2. í€´ì¦ˆ í’€ê¸° ì‹œì‘!
                </button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button id="print-questions-btn" class="w-full bg-gray-700 text-white p-4 rounded-lg font-bold text-lg hover:bg-gray-800 transition">
                        ë¬¸ì œì§€ë§Œ ì¸ì‡„í•˜ê¸°
                    </button>
                    <button id="print-answers-btn" class="w-full bg-gray-800 text-white p-4 rounded-lg font-bold text-lg hover:bg-gray-900 transition">
                        ì •ë‹µ/í•´ì„¤ë§Œ ì¸ì‡„í•˜ê¸°
                    </button>
                </div>
            </div>
            
             <!-- (ìˆ˜ì •) JSON ìˆ˜ì •í•˜ê¸° / ê³µìœ í•˜ê¸° ë²„íŠ¼ ê·¸ë£¹ --><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <button id="back-to-json-btn" class="w-full bg-gray-200 text-gray-700 p-3 rounded-lg hover:bg-gray-300 transition">
                    JSON ìˆ˜ì •í•˜ê¸°
                </button>
                <button id="share-link-btn" class="w-full bg-blue-100 text-blue-700 p-3 rounded-lg hover:bg-blue-200 transition">
                    ê³µìœ  ë§í¬ ìƒì„±
                </button>
             </div>
        </div>

        <!-- 3. í€´ì¦ˆ í’€ê¸° ì„¹ì…˜ (í€´ì¦ˆ ì‹œì‘ í›„ ë³´ì„) --><div id="quiz-section" class="p-6 md:p-8 hidden">
            <!-- í€´ì¦ˆ ìƒë‹¨ ë°” --><div class="flex justify-between items-center mb-6">
                <span id="quiz-run-title" class="text-lg font-bold text-gray-800 hidden"></span> <!-- (ì‹ ê·œ) í€´ì¦ˆ í’€ê¸° í™”ë©´ ì œëª© --><span id="progress-text" class="text-lg font-semibold text-gray-700">ë¬¸ì œ 1 / 10</span>
                <button id="quit-quiz-btn" class="text-sm text-red-600 hover:text-red-800 font-medium">
                    ì²˜ìŒìœ¼ë¡œ
                </button>
            </div>
            
            <!-- (ìˆ˜ì •) íƒ€ì´ë¨¸ í‘œì‹œ ì˜ì—­ --><div id="timer-container" class="flex justify-between items-center mb-4 hidden">
                <span id="time-left-text" class="text-lg font-bold text-indigo-700">--:--</span> <!-- (ìˆ˜ì •) 'ë‚¨ì€ ì‹œê°„:' í…ìŠ¤íŠ¸ ì‚­ì œ -->
                <div id="timer-bar-container">
                    <div id="timer-bar"></div>
                </div>
            </div>


            <!-- (ì‹ ê·œ) í€´ì¦ˆ ë‚´ìš© ì˜ì—­ - ì™¼ìª½ (ë¬¸ì œ, SVG) / ì˜¤ë¥¸ìª½ (ë³´ê¸°) --><div id="quiz-content-area" class="md:flex">
                <!-- ì™¼ìª½: ë¬¸ì œ ë° SVG ì°¸ê³ ìë£Œ --><div id="quiz-question-area" class="mb-6 md:mb-0">
                    <h2 id="question-title" class="text-2xl font-bold text-gray-900 mb-4"></h2>
                    <div id="question-svg-container" class="my-5 flex justify-center hidden">
                        <!-- JSê°€ ì´ê³³ì— SVGë¥¼ ì‚½ì… --></div>
                </div>
                
                <!-- ì˜¤ë¥¸ìª½: ë³´ê¸° ëª©ë¡ --><div id="quiz-options-area">
                    <ul id="options-list" class="space-y-3">
                        <!-- JSê°€ ì´ê³³ì— SVG ë³´ê¸° ë²„íŠ¼ì„ ì‚½ì… --></ul>
                </div>
            </div>

            <!-- í”¼ë“œë°± ë° ë‹¤ìŒ ë²„íŠ¼ --><div class="mt-6 border-t border-gray-200 pt-6">
                <p id="feedback-text" class="text-xl font-bold"></p>
                <p id="explanation-text" class="mt-3 text-gray-700 bg-gray-100 p-4 rounded-md hidden"></p>
                <button id="next-question-btn" class="w-full bg-blue-600 text-white p-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition mt-4 hidden">
                    ë‹¤ìŒ ë¬¸ì œë¡œ
                </button>
            </div>
        </div>

        <!-- 4. ìµœì¢… ê²°ê³¼ ì„¹ì…˜ (í€´ì¦ˆ ì¢…ë£Œ í›„ ë³´ì„) --><div id="results-section" class="p-6 md:p-10 text-center hidden">
            <h2 id="results-title" class="text-3xl font-bold text-gray-800 mb-4">í€´ì¦ˆ ì™„ë£Œ!</h2> <!-- (ìˆ˜ì •) í€´ì¦ˆ ê²°ê³¼ ì œëª© --><p class="text-xl text-gray-600 mb-6">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
            
            <div class="bg-blue-50 p-8 rounded-xl">
                <p class="text-lg text-blue-800">ì´ ë¬¸ì œ</p>
                <p id="total-questions-result" class="text-4xl font-extrabold text-blue-900 mb-4"></p>
                
                <p class="text-lg text-blue-800">ìµœì¢… ì ìˆ˜</p>
                <p id="final-score" class="text-6xl font-extrabold text-blue-900"></p>
            </div>

            <button id="restart-quiz-btn" class="w-full bg-blue-600 text-white p-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition mt-8">
                ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>

            <!-- (ì‹ ê·œ) í‹€ë¦° ë¬¸ì œ í•´ì„¤ ì„¹ì…˜ -->
            <div id="wrong-answers-section" class="mt-10 text-left hidden">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ ë³´ê¸°</h3>
                <div id="wrong-answers-list" class="space-y-6">
                    <!-- JSê°€ ì´ê³³ì— í‹€ë¦° ë¬¸ì œ í•´ì„¤ì„ ì‚½ì… -->
                </div>
            </div>
        </div>

    </div>

    <!-- 
      ======================================
      ì¸ì‡„ ì „ìš© HTML ì˜ì—­ (í‰ì†Œì—ëŠ” ì•ˆ ë³´ì„)
      ======================================
    --><div id="printable-area" class="hidden">
        <!-- 
          JSê°€ ì´ê³³ì— ì¸ì‡„ìš© ì»¨í…ì¸ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
          (1ë¶€: ë¬¸ì œì§€, 2ë¶€: ì •ë‹µì§€)
        --></div>


    <!-- 
      ======================================
      ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¡œì§
      ======================================
    --><script>
        // --- ì˜ˆì œ JSON ë°ì´í„° (ë¬¸ìì—´ í˜•íƒœ) ---
        // (ìˆ˜ì •) totalTimeLimitSeconds (ì´ ì‹œê°„)ìœ¼ë¡œ ë³€ê²½
        const DEFAULT_QUIZ_JSON = `
{
    "title": "ê¸°ë³¸ ìƒì‹ í€´ì¦ˆ",
    "totalTimeLimitSeconds": 60,
    "questions": [
        {
            "question": "ë‹¤ìŒ ì¤‘ HTML(HyperText Markup Language)ì˜ ì•½ìê°€ ì˜¬ë°”ë¥¸ ê²ƒì€?",
            "options": [
                { "text": "Hyperlinks and Text Markup Language 1234567890 1234567890 1234567890 1234567890" },
                { "text": "Home Tool Markup Language" },
                { "text": "HyperText Markup Language" },
                { "text": "Hyper Tool Multi Language" },
                { "text": "HighText Machine Language" }
            ],
            "answerIndex": 2,
            "explanation": "HTMLì€ 'HyperText Markup Language'ì˜ ì•½ìì…ë‹ˆë‹¤. ì›¹ í˜ì´ì§€ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ëŠ” ë§ˆí¬ì—… ì–¸ì–´ì…ë‹ˆë‹¤."
        },
        {
            "question": "ì›¹ í˜ì´ì§€ì˜ ìŠ¤íƒ€ì¼(ìƒ‰ìƒ, ê¸€ê¼´, ë ˆì´ì•„ì›ƒ)ì„ ì§€ì •í•˜ëŠ” ì–¸ì–´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "options": [
                { "text": "HTML" },
                { "text": "JQuery" },
                { "text": "Python" },
                { "text": "JavaScript" },
                { "text": "CSS" }
            ],
            "answerIndex": 4,
            "explanation": "CSS(Cascading Style Sheets)ëŠ” ì›¹ í˜ì´ì§€ì˜ ë””ìì¸ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤."
        },
        {
            "question": "ë‹¤ìŒ ë³´ê¸° ì¤‘ 'ë‘¥ê·¼ ì‚¬ê°í˜•(Rounded Rectangle)'ì„ ë‚˜íƒ€ë‚´ëŠ” SVGëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "svgImage": "<svg viewBox='0 0 100 60' xmlns='http://www.w3.org/2000/svg' class='w-full max-w-xs border rounded-md'><rect x='10' y='10' width='80' height='40' rx='10' stroke='blue' stroke-width='3' fill='lightblue'/><text x='50' y='35' text-anchor='middle' font-size='10' fill='black'>ì§ˆë¬¸ SVG</text></svg>",
            "options": [
                { "text": "ì›", "svgImage": "<svg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'><circle cx='20' cy='20' r='18' stroke='black' stroke-width='2' fill='none'/></svg>" },
                { "text": "ì¼ë°˜ ì‚¬ê°í˜•", "svgImage": "<svg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'><rect x='5' y='5' width='30' height='30' stroke='black' stroke-width='2' fill='none'/></svg>" },
                { "text": "ì‚¼ê°í˜•", "svgImage": "<svg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'><polygon points='20,5 35,35 5,35' stroke='black' stroke-width='2' fill='none'/></svg>" },
                { "text": "ë‘¥ê·¼ ì‚¬ê°í˜•", "svgImage": "<svg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'><rect x='5' y='5' width='30' height='30' rx='8' stroke='black' stroke-width='2' fill='none'/></svg>" },
                { "text": "íƒ€ì›", "svgImage": "<svg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'><ellipse cx='20' cy='20' rx='18' ry='12' stroke='black' stroke-width='2' fill='none'/></svg>" }
            ],
            "answerIndex": 3,
            "explanation": "ì •ë‹µì€ 4ë²ˆì§¸ ë³´ê¸°ì…ë‹ˆë‹¤. <rect> íƒœê·¸ì˜ 'rx' ì†ì„±ì€ ëª¨ì„œë¦¬ì˜ ë‘¥ê·¼ ì •ë„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤."
        },
        {
            "question": "ë‹¤ìŒ SVG ì½”ë“œì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?",
            "svgImage": "<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><circle cx='50' cy='50' r='40' fill='red'/></svg>",
            "options": [
                { "text": "íŒŒë€ìƒ‰ ì‚¬ê°í˜•ì„ ê·¸ë¦°ë‹¤." },
                { "text": "ì¤‘ì‹¬ì´ (50,50)ì¸ ë°˜ì§€ë¦„ 40ì˜ ë¹¨ê°„ìƒ‰ ì›ì„ ê·¸ë¦°ë‹¤." },
                { "text": "íƒ€ì›ì„ ê·¸ë¦°ë‹¤." },
                { "text": "í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•œë‹¤." },
                { "text": "ì„ ì„ ê·¸ë¦°ë‹¤." }
            ],
            "answerIndex": 1,
            "explanation": "<circle> íƒœê·¸ëŠ” ì›ì„, cx/cyëŠ” ì¤‘ì‹¬ ì¢Œí‘œ, rì€ ë°˜ì§€ë¦„, fillì€ ìƒ‰ìƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."
        }
    ]
}
`;

        // --- ì „ì—­ ë³€ìˆ˜ ë° ìƒíƒœ ---
        let db; // (ì‹ ê·œ) IndexedDB ì¸ìŠ¤í„´ìŠ¤
        const DB_NAME = 'QuizAppDB';
        const STORE_NAME = 'Quizzes';
        const QUIZ_ID_KEY = 'currentQuizData'; // (ì‹ ê·œ) DBì— ì €ì¥í•  í€´ì¦ˆì˜ í‚¤

        let currentQuiz = {}; 
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false; 
        let isLoadedFromUrl = false; 
        let timerInterval; 
        let timeLeft; 
        let wrongAnswers = []; 

        // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const jsonInputSection = document.getElementById('json-input-section'); 
        const jsonInput = document.getElementById('json-input');
        const jsonError = document.getElementById('json-error');
        const loadJsonBtn = document.getElementById('load-json-btn');
        const resetDefaultJsonBtn = document.getElementById('reset-default-json-btn');
        const copyJsonBtn = document.getElementById('copy-json-btn');
        const clearJsonBtn = document.getElementById('clear-json-btn'); 
        
        const actionControls = document.getElementById('action-controls');
        const quizTitleDisplay = document.getElementById('quiz-title-display'); 
        const loadStatus = document.getElementById('load-status');
        const questionCount = document.getElementById('question-count');
        const timerSettingDisplay = document.getElementById('timer-setting-display'); 
        
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const printQuestionsBtn = document.getElementById('print-questions-btn');
        const printAnswersBtn = document.getElementById('print-answers-btn');
        const backToJsonBtn = document.getElementById('back-to-json-btn');
        const shareLinkBtn = document.getElementById('share-link-btn'); 
        
        const quizSection = document.getElementById('quiz-section');
        const quizRunTitle = document.getElementById('quiz-run-title'); 
        const quitQuizBtn = document.getElementById('quit-quiz-btn');
        const progressText = document.getElementById('progress-text');
        const timerContainer = document.getElementById('timer-container'); 
        const timeLeftText = document.getElementById('time-left-text'); 
        const timerBar = document.getElementById('timer-bar'); 
        const timerBarContainer = document.getElementById('timer-bar-container'); // (ìˆ˜ì •) íƒ€ì´ë¨¸ ë°” ì»¨í…Œì´ë„ˆ ì°¸ì¡°
        
        const questionTitle = document.getElementById('question-title');
        const svgContainer = document.getElementById('question-svg-container');
        const optionsList = document.getElementById('options-list');
        const feedbackText = document.getElementById('feedback-text');
        const explanationText = document.getElementById('explanation-text');
        const nextQuestionBtn = document.getElementById('next-question-btn');

        const resultsSection = document.getElementById('results-section');
        const resultsTitle = document.getElementById('results-title'); 
        const totalQuestionsResult = document.getElementById('total-questions-result');
        const finalScore = document.getElementById('final-score');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const wrongAnswersSection = document.getElementById('wrong-answers-section'); 
        const wrongAnswersList = document.getElementById('wrong-answers-list'); 

        const printableArea = document.getElementById('printable-area');

        // --- (ì‹ ê·œ) IndexedDB í—¬í¼ í•¨ìˆ˜ ---

        /** DB ì´ˆê¸°í™” */
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, 1);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                    }
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log("IndexedDB initialized");
                    resolve(db);
                };
                
                request.onerror = (event) => {
                    console.error("IndexedDB error:", event.target.errorCode);
                    reject(event.target.errorCode);
                };
            });
        }

        /** DBì— í€´ì¦ˆ ì €ì¥ */
        function saveQuizToDB(id, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.error("DB not initialized.");
                    reject("DB not initialized");
                    return;
                }
                try {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.put({ id: id, data: data });
                    
                    request.onsuccess = () => resolve();
                    request.onerror = (event) => reject(event.target.error);
                } catch (error) {
                    reject(error);
                }
            });
        }

        /** DBì—ì„œ í€´ì¦ˆ ë¡œë“œ */
        function loadQuizFromDB(id) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.error("DB not initialized.");
                    reject("DB not initialized");
                    return;
                }
                try {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get(id);
                    
                    request.onsuccess = (event) => {
                        if (event.target.result) {
                            resolve(event.target.result.data);
                        } else {
                            reject("Quiz not found in DB");
                        }
                    };
                    request.onerror = (event) => reject(event.target.error);
                } catch (error) {
                    reject(error);
                }
            });
        }

        /** DBì—ì„œ í€´ì¦ˆ ì‚­ì œ */
        function deleteQuizFromDB(id) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    console.log("DB not initialized, nothing to delete.");
                    resolve(); // DBê°€ ì—†ìœ¼ë©´ ì‚­ì œí•  ê²ƒë„ ì—†ìŒ
                    return;
                }
                try {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.delete(id);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = (event) => reject(event.target.error);
                } catch (error) {
                    reject(error);
                }
            });
        }


        // --- í•¨ìˆ˜ ì •ì˜ ---

        /** 1. JSON ë¶ˆëŸ¬ì˜¤ê¸° ë° ìœ íš¨ì„± ê²€ì‚¬ */
        function loadJsonData() {
            try {
                const rawJson = jsonInput.value;
                const parsedData = JSON.parse(rawJson); 

                
                if (typeof parsedData !== 'object' || parsedData === null || !Array.isArray(parsedData.questions)) {
                    throw new Error("JSON ë°ì´í„°ëŠ” ìµœìƒìœ„ ê°ì²´ì—¬ì•¼ í•˜ë©°, 'questions' ë°°ì—´ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
                }

                if (parsedData.questions.length === 0) {
                    throw new Error("'questions' ë°°ì—´ì€ ë¹„ì–´ìˆì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.");
                }
                
                
                if (parsedData.title && typeof parsedData.title !== 'string') {
                    throw new Error("JSONì˜ 'title' ì†ì„±ì€ ë¬¸ìì—´(string)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                }

                
                if (parsedData.totalTimeLimitSeconds && typeof parsedData.totalTimeLimitSeconds !== 'number') {
                    throw new Error("JSONì˜ 'totalTimeLimitSeconds' ì†ì„±ì€ ìˆ«ì(number)ì—¬ì•¼ í•©ë‹ˆë‹¤.");
                }
                if (parsedData.totalTimeLimitSeconds && parsedData.totalTimeLimitSeconds <= 0) {
                    throw new Error("JSONì˜ 'totalTimeLimitSeconds'ì€ 0ë³´ë‹¤ í° ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
                }


                // ê° ë¬¸ì œì˜ í˜•ì‹ ê²€ì‚¬ (parsedData.questions ë°°ì—´ ìˆœíšŒ)
                for (const item of parsedData.questions) {
                    if (!item.question || !Array.isArray(item.options) || item.options.length === 0 || typeof item.answerIndex !== 'number') {
                        throw new Error("JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê° ë¬¸ì œëŠ” 'question', 'options' ë°°ì—´, 'answerIndex' ìˆ«ìê°€ í•„ìš”í•©ë‹ˆë‹¤.");
                    }
                    
                    for (const opt of item.options) {
                        if (typeof opt !== 'object' || opt === null || typeof opt.text !== 'string') {
                            throw new Error("ê° 'options' í•­ëª©ì€ 'text' ì†ì„±ì„ ê°€ì§„ ê°ì²´(object)ì—¬ì•¼ í•©ë‹ˆë‹¤.");
                        }
                        if (opt.svgImage && typeof opt.svgImage !== 'string') {
                            throw new Error("optionsì˜ 'svgImage' ì†ì„±ì´ ì¡´ì¬í•œë‹¤ë©´, ë¬¸ìì—´(string)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                        }
                    }
                    if (item.svgImage && typeof item.svgImage !== 'string') {
                        throw new Error("'svgImage' ì†ì„±ì´ ì¡´ì¬í•œë‹¤ë©´, ë¬¸ìì—´(string)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                    }
                    if (item.explanation && typeof item.explanation !== 'string') {
                        throw new Error("'explanation' ì†ì„±ì´ ì¡´ì¬í•œë‹¤ë©´, ë¬¸ìì—´(string)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                    }
                }

                // ì„±ê³µ
                currentQuiz = parsedData; 
                jsonError.classList.add('hidden');
                
                // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ í‘œì‹œ
                questionCount.textContent = currentQuiz.questions.length; 
                loadStatus.classList.remove('hidden'); 
                
                
                quizTitleDisplay.textContent = currentQuiz.title || "ì œëª© ì—†ëŠ” í€´ì¦ˆ";
                
                resultsTitle.textContent = currentQuiz.title ? `${currentQuiz.title} í€´ì¦ˆ ì™„ë£Œ!` : "í€´ì¦ˆ ì™„ë£Œ!";
                quizRunTitle.textContent = currentQuiz.title || "í€´ì¦ˆ í’€ê¸°";
                quizRunTitle.classList.remove('hidden');

                
                if (currentQuiz.totalTimeLimitSeconds) {
                    const minutes = Math.floor(currentQuiz.totalTimeLimitSeconds / 60);
                    const seconds = currentQuiz.totalTimeLimitSeconds % 60;
                    timerSettingDisplay.textContent = `(ì´ ì œí•œ ì‹œê°„: ${minutes}:${seconds.toString().padStart(2, '0')})`;
                    timerSettingDisplay.classList.remove('hidden');
                } else {
                    timerSettingDisplay.classList.add('hidden');
                }

                actionControls.classList.remove('hidden'); 
                
                
                if (isLoadedFromUrl) {
                    backToJsonBtn.classList.add('hidden');
                    shareLinkBtn.classList.add('hidden');
                } else {
                    backToJsonBtn.classList.remove('hidden');
                    shareLinkBtn.classList.remove('hidden');
                }
                
                // ë‹¤ë¥¸ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                quizSection.classList.add('hidden');
                resultsSection.classList.add('hidden');
                jsonInputSection.classList.add('hidden'); 

            } catch (error) {
                // ì‹¤íŒ¨
                currentQuiz = {}; 
                isLoadedFromUrl = false; 
                jsonError.textContent = `JSON ì˜¤ë¥˜: ${error.message}`;
                jsonError.classList.remove('hidden');
                actionControls.classList.add('hidden'); 
                jsonInputSection.classList.remove('hidden'); 
            }
        }

        /** íƒ€ì´ë¨¸ í‘œì‹œ í—¬í¼ í•¨ìˆ˜ (MM:SS í˜•ì‹) */
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timeLeftText.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }


        /** 2. í€´ì¦ˆ ì‹œì‘ (ìˆ˜ì •: ì „ì—­ íƒ€ì´ë¨¸ ì‹œì‘) */
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = []; 
            
            actionControls.classList.add('hidden'); 
            resultsSection.classList.add('hidden');
            quizSection.classList.remove('hidden');
            
            
            clearInterval(timerInterval); // ì´ì „ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
            if (currentQuiz.totalTimeLimitSeconds) {
                timeLeft = currentQuiz.totalTimeLimitSeconds;
                timerContainer.classList.remove('hidden');
                updateTimerDisplay();
                
                timerBar.style.transition = 'none'; // ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
                timerBar.style.width = '100%';
                
                
                setTimeout(() => {
                    timerBar.style.transition = `width ${timeLeft}s linear`;
                    timerBar.style.width = '0%';
                }, 100);

                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        showResults(true); // ì‹œê°„ ì´ˆê³¼ë¡œ ê²°ê³¼ í‘œì‹œ
                    }
                }, 1000);
            } else {
                timerContainer.classList.add('hidden');
            }
            
            loadQuestion();
        }

        /** 3. ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì •: í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆì„ ìœ„í•´ <text> -> <foreignObject>ë¡œ ë³€ê²½) */
        function loadQuestion() {
            // ì´ˆê¸°í™”
            isAnswered = false;
            feedbackText.textContent = '';
            explanationText.textContent = '';
            explanationText.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            
            const currentQuestion = currentQuiz.questions[currentQuestionIndex]; 
            
            progressText.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${currentQuiz.questions.length}`;
            questionTitle.textContent = currentQuestion.question;
            
            if (currentQuestion.svgImage) {
                svgContainer.innerHTML = currentQuestion.svgImage;
                svgContainer.classList.remove('hidden');
            } else {
                svgContainer.innerHTML = '';
                svgContainer.classList.add('hidden');
            }

            // ë³´ê¸° ë²„íŠ¼ ìƒì„± (SVGë¡œ ë³€ê²½)
            optionsList.innerHTML = '';
            const svgNS = "http://www.w3.org/2000/svg";

            currentQuestion.options.forEach((option, index) => {
                const li = document.createElement('li');
                
                const svg = document.createElementNS(svgNS, 'svg');
                svg.setAttribute('width', '100%');
                svg.setAttribute('height', '56');
                svg.setAttribute('viewBox', '0 0 500 56');
                svg.classList.add('svg-option');
                svg.style.cursor = 'pointer';

                const rect = document.createElementNS(svgNS, 'rect');
                rect.setAttribute('x', '1');
                rect.setAttribute('y', '1');
                rect.setAttribute('width', '498');
                rect.setAttribute('height', '54');
                rect.setAttribute('rx', '8');
                rect.setAttribute('ry', '8');
                rect.setAttribute('fill', '#f3f4f6');
                rect.setAttribute('stroke', '#d1d5db');
                rect.setAttribute('stroke-width', '1.5');
                
                // (ìˆ˜ì •) SVG <text> ëŒ€ì‹  <foreignObject>ì™€ HTML <div>ë¥¼ ì‚¬ìš©í•´ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                const textForeignObject = document.createElementNS(svgNS, 'foreignObject');
                textForeignObject.setAttribute('x', '20'); // ì¢Œì¸¡ íŒ¨ë”©
                textForeignObject.setAttribute('y', '1');  // ìƒë‹¨ ì •ë ¬
                textForeignObject.setAttribute('width', '410'); // í…ìŠ¤íŠ¸ ì˜ì—­ ë„ˆë¹„ (440(ì´ë¯¸ì§€ ì‹œì‘) - 20(ì¢Œì¸¡íŒ¨ë”©) - 10(ìš°ì¸¡íŒ¨ë”©))
                textForeignObject.setAttribute('height', '54'); // <rect>ì™€ ë™ì¼í•œ ë†’ì´
                
                const textDiv = document.createElement('div');
                // (ìˆ˜ì •) HTML <div>ì— ìŠ¤íƒ€ì¼ ì ìš© (ì¤„ë°”ê¿ˆ, ìˆ˜ì§ ì •ë ¬, í°íŠ¸)
                textDiv.setAttribute('style', `
                    display: flex; 
                    align-items: center; 
                    height: 100%; 
                    width: 100%;
                    font-family: 'Inter', 'Pretendard', sans-serif; 
                    font-size: 16px; 
                    color: #111827; 
                    white-space: normal; 
                    word-break: break-all; /* ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ê³µë°± ì—†ëŠ” ê¸´ í…ìŠ¤íŠ¸ë„ ê°•ì œ ì¤„ë°”ê¿ˆ */
                    padding-right: 10px; /* ìš°ì¸¡ SVG ì´ë¯¸ì§€ì™€ì˜ ê°„ê²© */
                    pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ SVGë¡œ ì „ë‹¬ë˜ë„ë¡ í•¨ */
                `);
                textDiv.textContent = `(${index + 1}) ${option.text}`;
                
                textForeignObject.appendChild(textDiv);

                svg.appendChild(rect);
                svg.appendChild(textForeignObject); // (ìˆ˜ì •) <text> ëŒ€ì‹  <foreignObject> ì‚½ì…

                // ë³´ê¸°(ì„ ì§€)ì˜ SVG ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš° (ì´ ë¶€ë¶„ì€ ë™ì¼)
                if (option.svgImage) {
                    const foreignObject = document.createElementNS(svgNS, 'foreignObject');
                    foreignObject.setAttribute('x', '440'); // í…ìŠ¤íŠ¸ ì˜ì—­(410) + íŒ¨ë”©(20) + ì—¬ë°±(10)
                    foreignObject.setAttribute('y', '8');
                    foreignObject.setAttribute('width', '40');
                    foreignObject.setAttribute('height', '40');
                    
                    const div = document.createElement('div');
                    div.setAttribute('style', 'width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; pointer-events: none;');
                    div.innerHTML = option.svgImage;

                    const embeddedSvg = div.querySelector('svg');
                    if (embeddedSvg) {
                        embeddedSvg.setAttribute('width', '100%');
                        embeddedSvg.setAttribute('height', '100%');
                    }
                    
                    foreignObject.appendChild(div);
                    svg.appendChild(foreignObject);
                }
                
                svg.addEventListener('click', () => selectAnswer(svg, index));
                
                li.appendChild(svg);
                optionsList.appendChild(li);
            });
        }

        /** 4. ë‹µì•ˆ ì„ íƒ (ìˆ˜ì •: íƒ€ì´ë¨¸ ì¼ì‹œ ì •ì§€) */
        function selectAnswer(selectedSvg, selectedIndex) {
            if (isAnswered) return;
            
            
            clearInterval(timerInterval); 
            
            // (ìˆ˜ì •) timerBarì™€ timerBarContainerê°€ ëª¨ë‘ ì¡´ì¬í•  ë•Œë§Œ ì‹¤í–‰
            if(currentQuiz.totalTimeLimitSeconds && timerBar && timerBarContainer) {
                const currentWidth = timerBar.getBoundingClientRect().width;
                const containerWidth = timerBarContainer.getBoundingClientRect().width;
                timerBar.style.transition = 'none';

                // (ìˆ˜ì •) 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€
                if (containerWidth > 0) {
                    timerBar.style.width = `${(currentWidth / containerWidth) * 100}%`;
                } else if (timeLeft <= 0) {
                     timerBar.style.width = '0%'; // ì‹œê°„ì´ ë‹¤ ëœ ê²½ìš°
                }
                // containerWidthê°€ 0ì´ê³  ì‹œê°„ì´ ë‚¨ì€ ê²½ìš°, ë„ˆë¹„ ë³€ê²½ ì—†ìŒ (í˜„ì¬ ê°’ ìœ ì§€)
            }

            isAnswered = true;
            const currentQuestion = currentQuiz.questions[currentQuestionIndex]; 
            const correctIndex = currentQuestion.answerIndex;

            const allOptionSvgs = optionsList.querySelectorAll('.svg-option');
            
            if (selectedIndex === correctIndex) {
                // ì •ë‹µ
                score++;
                const selectedRect = selectedSvg.querySelector('rect');
                if (selectedRect) {
                    selectedRect.setAttribute('fill', '#dcfce7');
                    selectedRect.setAttribute('stroke', '#22c55e');
                    selectedRect.setAttribute('stroke-width', '2');
                }
                feedbackText.textContent = 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!';
                feedbackText.style.color = 'green';
            } else {
                // ì˜¤ë‹µ
                wrongAnswers.push(currentQuestionIndex); 
                const selectedRect = selectedSvg.querySelector('rect');
                if (selectedRect) {
                    selectedRect.setAttribute('fill', '#fee2e2');
                    selectedRect.setAttribute('stroke', '#ef4444');
                    selectedRect.setAttribute('stroke-width', '2');
                }
                feedbackText.textContent = 'âŒ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                feedbackText.style.color = 'red';
            }

            // ì •ë‹µ í‘œì‹œ
            const correctSvg = allOptionSvgs[correctIndex];
            if (correctSvg) {
                const correctRect = correctSvg.querySelector('rect');
                if (correctRect) {
                    correctRect.setAttribute('fill', '#dcfce7');
                    correctRect.setAttribute('stroke', '#22c55e');
                    correctRect.setAttribute('stroke-width', '2');
                }
            }


            if (currentQuestion.explanation) {
                explanationText.textContent = `í’€ì´: ${currentQuestion.explanation}`;
                explanationText.classList.remove('hidden');
            }

            nextQuestionBtn.classList.remove('hidden');
            allOptionSvgs.forEach(svg => {
                svg.style.cursor = 'default';
            });
        }

        /** 5. ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™ (ìˆ˜ì •: íƒ€ì´ë¨¸ ì¬ì‹œì‘) */
        function goToNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuiz.questions.length) { 
                
                
                if (currentQuiz.totalTimeLimitSeconds && timeLeft > 0) {
                    updateTimerDisplay(); // í˜„ì¬ ë‚¨ì€ ì‹œê°„ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                    
                    timerBar.style.transition = 'none'; // ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
                    
                    setTimeout(() => {
                        timerBar.style.transition = `width ${timeLeft}s linear`;
                        timerBar.style.width = '0%';
                    }, 100);

                    timerInterval = setInterval(() => {
                        timeLeft--;
                        updateTimerDisplay();
                        
                        if (timeLeft <= 0) {
                            clearInterval(timerInterval);
                            showResults(true); // ì‹œê°„ ì´ˆê³¼
                        }
                    }, 1000);
                }
                
                loadQuestion();
            } else {
                showResults(false); // ì‹œê°„ ì´ˆê³¼ ì•„ë‹˜
                
            }
        }

        /** 6. ê²°ê³¼ í™”ë©´ í‘œì‹œ (ìˆ˜ì •: í‹€ë¦° ë¬¸ì œ í•´ì„¤ ì¶”ê°€) */
        function showResults(isTimeOut = false) {
            clearInterval(timerInterval); 
            
            quizSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');

            
            const title = currentQuiz.title || "í€´ì¦ˆ";
            if (isTimeOut) {
                resultsTitle.textContent = "â° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤!";
            } else {
                resultsTitle.textContent = `${title} í€´ì¦ˆ ì™„ë£Œ!`;
            }
            
            totalQuestionsResult.textContent = `${currentQuiz.questions.length} ë¬¸ì œ`; 
            finalScore.textContent = `${score} ê°œ`;

            
            wrongAnswersList.innerHTML = ''; // ì´ˆê¸°í™”
            if (wrongAnswers.length > 0) {
                wrongAnswersSection.classList.remove('hidden');
                
                wrongAnswers.forEach(wrongIndex => {
                    const question = currentQuiz.questions[wrongIndex];
                    
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'p-4 bg-gray-50 rounded-lg border border-gray-200';
                    
                    // 1. ë¬¸ì œ
                    const qTitle = document.createElement('h4');
                    qTitle.className = 'text-lg font-bold text-gray-800 mb-2';
                    qTitle.textContent = `[ë¬¸ì œ ${wrongIndex + 1}] ${question.question}`;
                    itemDiv.appendChild(qTitle);
                    
                    // 2. ì •ë‹µ
                    const answer = document.createElement('p');
                    answer.className = 'text-md font-semibold text-green-700';
                    const correctOptionText = question.options[question.answerIndex].text;
                    answer.textContent = `ì •ë‹µ: (${question.answerIndex + 1}) ${correctOptionText}`;
                    itemDiv.appendChild(answer);
                    
                    // 3. í•´ì„¤
                    if (question.explanation) {
                        const explanation = document.createElement('p');
                        explanation.className = 'text-md text-gray-700 mt-2 pt-2 border-t border-gray-200';
                        explanation.textContent = `í’€ì´: ${question.explanation}`;
                        itemDiv.appendChild(explanation);
                    }
                    
                    wrongAnswersList.appendChild(itemDiv);
                });

            } else {
                // í‹€ë¦° ë¬¸ì œê°€ ì—†ìœ¼ë©´ ì„¹ì…˜ ìˆ¨ê¹€
                wrongAnswersSection.classList.add('hidden');
            }
        }

        /** 7. ì•± ì´ˆê¸°í™” (ì²˜ìŒìœ¼ë¡œ) (ìˆ˜ì •: DB ì‚­ì œ ì¶”ê°€) */
        async function resetApp() {
            // (ì‹ ê·œ) DBì— ì €ì¥ëœ í€´ì¦ˆê°€ ìˆë‹¤ë©´ ì‚­ì œ
            try {
                await deleteQuizFromDB(QUIZ_ID_KEY);
                console.log("Quiz data cleared from DB.");
            } catch (error) {
                console.error("Failed to clear quiz data from DB:", error);
            }

            currentQuiz = {}; 
            currentQuestionIndex = 0;
            score = 0;
            isLoadedFromUrl = false; 
            clearInterval(timerInterval); 
            wrongAnswers = []; 
            
            quizSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            wrongAnswersSection.classList.add('hidden'); 
            wrongAnswersList.innerHTML = ''; 
            actionControls.classList.add('hidden');
            loadStatus.classList.add('hidden');
            
            jsonInputSection.classList.remove('hidden'); 
            
            // URL ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì„ ì§€ìš°ê³  ì•±ì„ ë¦¬ì…‹í•¨
            window.history.pushState({}, '', window.location.pathname);
            jsonInput.value = DEFAULT_QUIZ_JSON;
            jsonError.classList.add('hidden');
        }


        /** 9a. ë¬¸ì œì§€ë§Œ ì¸ì‡„í•˜ê¸° */
        function printQuestionsOnly() {
            printableArea.innerHTML = '';

            
            const quizTitle = document.createElement('h1');
            quizTitle.innerHTML = currentQuiz.title || "í€´ì¦ˆ ë¬¸ì œì§€";
            quizTitle.className = 'print-quiz-title';
            printableArea.appendChild(quizTitle);

            const questionsContainer = document.createElement('div');
            questionsContainer.className = 'print-column-container';

            currentQuiz.questions.forEach((question, index) => { 
                const itemDiv = document.createElement('div');
                itemDiv.className = 'print-question-item';

                // 1. ë¬¸ì œ
                const qTitle = document.createElement('h2');
                qTitle.className = 'print-question-title';
                qTitle.textContent = `${index + 1}. ${question.question}`;
                itemDiv.appendChild(qTitle);

                // 2. ë¬¸ì œ SVG
                if (question.svgImage) {
                    const svgContainer = document.createElement('div');
                    svgContainer.className = 'print-question-svg';
                    svgContainer.innerHTML = question.svgImage;
                    const innerSvg = svgContainer.querySelector('svg');
                    if(innerSvg) {
                        innerSvg.setAttribute('width', '100%');
                        innerSvg.setAttribute('height', 'auto');
                    }
                    itemDiv.appendChild(svgContainer);
                }

                // 3. ë³´ê¸°
                const optionsOl = document.createElement('ol');
                optionsOl.className = 'print-options';
                
                question.options.forEach((option, optionIndex) => {
                    const li = document.createElement('li');
                    li.className = 'print-option-item';
                    
                    const textSpan = document.createElement('span');
                    // í…ìŠ¤íŠ¸ì— (1), (2) ë²ˆí˜¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€
                    textSpan.textContent = `(${optionIndex + 1}) ${option.text}`;
                    li.appendChild(textSpan);

                    if (option.svgImage) {
                        const optionSvgContainer = document.createElement('div');
                        optionSvgContainer.className = 'print-option-svg';
                        optionSvgContainer.innerHTML = option.svgImage;
                        const innerOptionSvg = optionSvgContainer.querySelector('svg');
                        if(innerOptionSvg) {
                            innerOptionSvg.setAttribute('width', '100%');
                            innerOptionSvg.setAttribute('height', '100%');
                        }
                        li.appendChild(optionSvgContainer);
                    }
                    
                    optionsOl.appendChild(li);
                });
                itemDiv.appendChild(optionsOl);

                questionsContainer.appendChild(itemDiv);
            });
            
            printableArea.appendChild(questionsContainer);

            window.print();
        }

        /** 9b. ì •ë‹µ/í•´ì„¤ë§Œ ì¸ì‡„í•˜ê¸° (ë¹ ë¥¸ ì •ë‹µ + ìƒì„¸ í’€ì´) */
        function printAnswersOnly() {
            printableArea.innerHTML = '';

            // --- 0. ì „ì²´ ì œëª© ---
            const answersTitle = document.createElement('h1');
            answersTitle.innerHTML = (currentQuiz.title ? `${currentQuiz.title} ` : "") + 'ì •ë‹µ ë° í’€ì´'; 
            answersTitle.className = 'print-answer-key-title';
            printableArea.appendChild(answersTitle);

            // --- 1. ë¹ ë¥¸ ì •ë‹µ ---
            const quickKeyTitle = document.createElement('h2');
            quickKeyTitle.innerHTML = 'ë¹ ë¥¸ ì •ë‹µ';
            quickKeyTitle.className = 'print-quick-key-title';
            printableArea.appendChild(quickKeyTitle);

            const quickKeyContainer = document.createElement('div');
            quickKeyContainer.className = 'print-quick-key-container';
            
            currentQuiz.questions.forEach((question, index) => { 
                const keyItem = document.createElement('span');
                keyItem.className = 'print-quick-key-item';
                keyItem.textContent = `${index + 1}. (${question.answerIndex + 1})`; // ì˜ˆ: 1. (3)
                quickKeyContainer.appendChild(keyItem);
            });
            printableArea.appendChild(quickKeyContainer);

            // --- 2. ìƒì„¸ í’€ì´ ---
            const detailedTitle = document.createElement('h2');
            detailedTitle.innerHTML = 'ìƒì„¸ í’€ì´';
            detailedTitle.className = 'print-detailed-explanation-title';
            printableArea.appendChild(detailedTitle);

            // 2ì—´ ì»¨í…Œì´ë„ˆ ìƒì„±
            const explanationsContainer = document.createElement('div');
            explanationsContainer.className = 'print-column-container';

            currentQuiz.questions.forEach((question, index) => { 
                const answerItemDiv = document.createElement('div');
                answerItemDiv.className = 'print-answer-item';

                // ë¬¸ì œ ë²ˆí˜¸
                const qNum = document.createElement('h3');
                qNum.style.fontWeight = 'bold';
                qNum.textContent = `[${index + 1}ë²ˆ ë¬¸ì œ]`;
                answerItemDiv.appendChild(qNum);
                
                // ì •ë‹µ
                const answer = document.createElement('p');
                answer.className = 'print-answer';
                const correctOptionText = question.options[question.answerIndex].text;
                answer.textContent = `ì •ë‹µ: (${question.answerIndex + 1}) ${correctOptionText}`;
                answerItemDiv.appendChild(answer);
                
                // í’€ì´
                if (question.explanation) {
                    const explanation = document.createElement('p');
                    explanation.className = 'print-explanation';
                    explanation.textContent = `í’€ì´: ${question.explanation}`;
                    answerItemDiv.appendChild(explanation);
                }
                
                explanationsContainer.appendChild(answerItemDiv);
            });
            
            printableArea.appendChild(explanationsContainer);

            window.print();
        }

        /** 10. JSON í…ìŠ¤íŠ¸ ë³µì‚¬ */
        function copyJsonToClipboard() {
            jsonInput.select();
            
            try {
                document.execCommand('copy');
                copyJsonBtn.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                copyJsonBtn.classList.add('bg-green-200');
                
                setTimeout(() => {
                    copyJsonBtn.textContent = 'ì˜ˆì œ ë³µì‚¬';
                    copyJsonBtn.classList.remove('bg-green-200');
                }, 2000);
            } catch (err) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        /** 11. JSON ìˆ˜ì •í•˜ê¸° (ì•¡ì…˜ ì»¨íŠ¸ë¡¤ -> JSON ì…ë ¥) */
        function backToJsonEditor() {
            actionControls.classList.add('hidden');
            loadStatus.classList.add('hidden');
            jsonInputSection.classList.remove('hidden'); 
        }

        /** 12. JSON ì…ë ¥ì°½ ë¹„ìš°ê¸° */
        function clearJsonInput() {
            jsonInput.value = '';
            jsonError.classList.add('hidden');
        }

        /** 13. (ìˆ˜ì •) URL í•´ì‹œ ì²˜ë¦¬ -> DB ì €ì¥ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ */
        async function handleHashRedirect(hash) {
            try {
                isLoadedFromUrl = true; 
                
                const quizDataB64 = hash.substring(3); // #q= ë¥¼ ì œê±°
                
                
                const standardBase64 = quizDataB64.replace(/-/g, '+').replace(/_/g, '/');
                const binaryString = atob(standardBase64);
                
                const utf8Bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    utf8Bytes[i] = binaryString.charCodeAt(i);
                }
                
                const decodedJson = new TextDecoder().decode(utf8Bytes);
                
                // (ì‹ ê·œ) DBì— ì €ì¥
                await saveQuizToDB(QUIZ_ID_KEY, decodedJson);
                
                // (ì‹ ê·œ) ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                window.location.href = window.location.pathname + "?j=1";
                // ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ì‹¤í–‰ë  ê²ƒì´ë¯€ë¡œ, ì´í›„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì€ ì¤‘ë‹¨ë¨
                
            } catch (error) {
                console.error("URL í•´ì‹œ ì²˜ë¦¬ ì‹¤íŒ¨:", error);
                isLoadedFromUrl = false; 
                jsonError.textContent = "URLì—ì„œ í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë§í¬ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.";
                jsonError.classList.remove('hidden');
                jsonInputSection.classList.remove('hidden'); 
            }
        }

        /** 14. ê³µìœ  ë§í¬ ìƒì„± (í•´ì‹œ ì‚¬ìš©) */
        function generateShareLink() {
            try {
                const jsonData = jsonInput.value;

                
                const utf8Bytes = new TextEncoder().encode(jsonData);
                const binaryString = String.fromCodePoint(...utf8Bytes);
                const base64Data = btoa(binaryString).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
                
                
                const shareUrl = `${window.location.origin}${window.location.pathname}#q=${base64Data}`;

                
                const tempInput = document.createElement('textarea');
                tempInput.value = shareUrl;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                shareLinkBtn.textContent = 'ë§í¬ ë³µì‚¬ ì™„ë£Œ!';
                shareLinkBtn.classList.add('bg-green-200');
                
                setTimeout(() => {
                    shareLinkBtn.textContent = 'ê³µìœ  ë§í¬ ìƒì„±';
                    shareLinkBtn.classList.remove('bg-green-200');
                }, 2000);

            } catch (error) {
                console.error("ê³µìœ  ë§í¬ ìƒì„± ì‹¤íŒ¨:", error);
                alert("ë§í¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (JSON ë°ì´í„°ê°€ ë„ˆë¬´ í´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)");
            }
        }
        
        /** (ì‹ ê·œ) ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì—ì„œ í€´ì¦ˆ ë¡œë“œ */
        async function loadQuizFromQuery() {
            try {
                const decodedJson = await loadQuizFromDB(QUIZ_ID_KEY);
                jsonInput.value = decodedJson;
                isLoadedFromUrl = true; // URLë¡œ ë¡œë“œë¨ (ìˆ˜ì • ë²„íŠ¼ ìˆ¨ê¸°ê¸°ìš©)
                loadJsonData(); // í€´ì¦ˆ ë°ì´í„° íŒŒì‹± ë° UI í‘œì‹œ
            } catch (error) {
                console.error("DBì—ì„œ í€´ì¦ˆ ë¡œë“œ ì‹¤íŒ¨:", error);
                jsonError.textContent = "í€´ì¦ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë§í¬ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì˜ëª»ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                jsonError.classList.remove('hidden');
                jsonInputSection.classList.remove('hidden'); // JSON ì…ë ¥ì°½ í‘œì‹œ
                // URLì—ì„œ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ì œê±°
                window.history.pushState({}, '', window.location.pathname);
            }
        }


        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° (ìˆ˜ì •: async DOMContentLoaded) ---
        window.addEventListener('DOMContentLoaded', async () => { // (ìˆ˜ì •) async ì¶”ê°€
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìš°ì„  ë“±ë¡
            loadJsonBtn.addEventListener('click', loadJsonData);
            resetDefaultJsonBtn.addEventListener('click', () => {
                jsonInput.value = DEFAULT_QUIZ_JSON;
                jsonError.classList.add('hidden');
            });
            copyJsonBtn.addEventListener('click', copyJsonToClipboard);
            clearJsonBtn.addEventListener('click', clearJsonInput);
            
            backToJsonBtn.addEventListener('click', backToJsonEditor);
            shareLinkBtn.addEventListener('click', generateShareLink);
            
            startQuizBtn.addEventListener('click', startQuiz);
            printQuestionsBtn.addEventListener('click', printQuestionsOnly);
            printAnswersBtn.addEventListener('click', printAnswersOnly);
            
            quitQuizBtn.addEventListener('click', resetApp);
            
            nextQuestionBtn.addEventListener('click', goToNextQuestion);
            restartQuizBtn.addEventListener('click', resetApp);

            // (ì‹ ê·œ) í˜ì´ì§€ ë¡œë“œ ì‹œ URL ë¼ìš°íŒ… ë¡œì§
            try {
                await initDB(); // DBë¶€í„° ì´ˆê¸°í™”

                const hash = window.location.hash;
                const params = new URLSearchParams(window.location.search);
                const quizKey = params.get('j');

                if (hash && hash.startsWith('#q=')) {
                    // ì‹œë‚˜ë¦¬ì˜¤ 1: í•´ì‹œ(#q=)ê°€ ìˆìŒ -> DBì— ì €ì¥í•˜ê³  ë¦¬ë‹¤ì´ë ‰íŠ¸
                    await handleHashRedirect(hash);
                    // ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë°œìƒí•˜ë¯€ë¡œ, ì´í›„ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
                
                } else if (quizKey === '1') {
                    // ì‹œë‚˜ë£Œ 2: ì¿¼ë¦¬(?j=1)ê°€ ìˆìŒ -> DBì—ì„œ ë¡œë“œí•˜ì—¬ í€´ì¦ˆ í‘œì‹œ
                    await loadQuizFromQuery();
                
                } else {
                    // ì‹œë‚˜ë¦¬ì˜¤ 3: ì•„ë¬´ê²ƒë„ ì—†ìŒ -> ê¸°ë³¸ í¸ì§‘ê¸° í™”ë©´
                    jsonInput.value = DEFAULT_QUIZ_JSON;
                    jsonInputSection.classList.remove('hidden'); // (ìˆ˜ì •) ê¸°ë³¸ í™”ë©´ ëª…ì‹œì  í‘œì‹œ
                }
                
            } catch (error) {
                console.error("App initialization failed:", error);
                jsonError.textContent = "ì•± ì´ˆê¸°í™” ì‹¤íŒ¨. ê¸°ë³¸ ëª¨ë“œë¡œ ì‹œì‘í•©ë‹ˆë‹¤.";
                jsonError.classList.remove('hidden');
                jsonInput.value = DEFAULT_QUIZ_JSON;
                jsonInputSection.classList.remove('hidden');
            }
        });

    </script>
</body>
</html>
